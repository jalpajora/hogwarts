import React, { useState, useEffect } from 'react';
import PropTypes from 'prop-types';

import { fetchHouse } from '../@helpers';

const SortingHat = (props) => {
  const houses = ['slytherin', 'gryffindor', 'hufflepuff', 'ravenclaw'];
  const [hatTheme, updateHatTheme] = useState('');
  const [start, updateSortingStatus] = useState(false);
  const [house, updateHouse] = useState('');


  useEffect(() => {
    let hatThemeInterval;
    if (start) {
      let count = 0;
      hatThemeInterval = setInterval(() => {
        updateHatTheme(houses[count]);
        count = houses.length -1 === count ? 0 : count + 1;
      }, 1000);
    }

    return () => clearInterval(hatThemeInterval);
  }, [start]);

  const handleClick = async () => {
    updateSortingStatus(true);
    const sortedHouse = await fetchHouse();
    props.onJoin(sortedHouse);

    setTimeout(() => {
      updateHouse(sortedHouse);
      updateSortingStatus(false);
    }, 5000);
  }


  const renderSortingHat = () => (
    <svg className={`sorting-hat__img sorting-hat__img--${house.toLocaleLowerCase() || hatTheme}`} enableBackground="new 0 0 222.801 222.801" version="1.1" viewBox="0 0 222.8 222.8" xmlSpace="preserve" xmlns="http://www.w3.org/2000/svg">
      <path d="m52.735 201.71c-12.136 0-46.873-1.7-51.938-20.902-1.613-6.117-0.775-10.956 2.489-14.382 7.58-7.956 25.203-4.482 27.188-4.06 7.789 1.657 22.872 3.607 28.572 4.318 2.004-2.537 5.619-7.678 6.023-10.913 0.103-0.824 0.175-1.735 0.252-2.716 0.415-5.205 0.982-12.334 6.485-19.107 5.95-7.323 8.593-18.135 10.172-24.596 0.347-1.417 0.886-4.076 1.568-7.442 3.687-18.174 8.009-38.066 12.667-44.072 4.8-6.19 8.396-8.034 10.143-8.583 1.718-2.503 8.075-11.806 11.015-16.617 0.527-0.862 0.974-1.69 1.406-2.491 2.717-5.034 4.903-8.148 15.168-8.71 13.25-0.727 18.285-0.358 20.72 1.515 1.122 0.863 1.814 2.053 2.484 3.203 0.846 1.455 1.577 2.71 3.044 3.311 0.97 0.396 3.065 0.954 5.493 1.6 5.82 1.548 13.79 3.668 18.899 6.734 5.777 3.466 8.348 6.574 7.64 9.238-0.534 2.011-2.641 3.07-6.262 3.147-4.405 0.094-9.266-0.451-13.55-0.933-2.947-0.331-5.73-0.644-7.618-0.644h-0.476c-4.814 6e-3 -5.326 0.214-5.753 2.608-0.871 4.878-3.909 8.942-7.741 10.354-1.27 0.468-2.53 0.905-3.572 1.256 0.811 1.393 1.913 3.503 3.292 6.621 2.6 5.885 3.274 16.531 3.435 20.259 1.944 0.935 5.249 3.144 5.249 7.35 0 2.942-1.076 3.933-2.178 4.694-0.231 0.16-0.42 0.291-0.562 0.638-0.017 0.054-0.036 0.107-0.057 0.159-0.094 0.303-0.163 0.74-0.203 1.408-0.186 3.063 0.681 5.793 1.52 8.432 0.461 1.452 0.897 2.824 1.134 4.189l0.285 1.657c0.51 2.988 0.95 5.569 1.724 8.407 0.886 3.249 1.779 5.836 3.958 10.194 1.919 3.839 4.323 12.271 5.097 15.074 1.282 0.688 3.344 2.209 4.18 5.136 0.948 3.317-0.518 6.513-1.203 7.749l-0.042 1.239c2.486-0.172 4.596-0.339 6.485-0.499 8.931-0.756 18.686-0.767 25.237-0.706 9.472-0.14 15.309 1.774 17.414 5.694 1.391 2.589 0.911 5.795-1.353 9.029-5.448 7.781-39.537 9.344-51.576 8.627-13.907-0.831-29.009-1.489-29.16-1.496-0.353-0.015-0.681-0.121-0.961-0.294-2.281 0.627-4.523 1.211-6.707 1.738-24.344 5.876-65.735 13.066-75.421 13.507-0.32 0.017-1.81 0.078-4.105 0.078zm-33.176-36.491c-5.196 0-10.503 0.951-13.377 3.967-2.242 2.353-2.752 5.919-1.517 10.602 4.322 16.387 39 18.445 51.997 17.851 9.316-0.423 50.987-7.684 74.664-13.399 9.359-2.259 19.88-5.611 30.055-8.853 6.665-2.124 13.182-4.2 19.255-5.941-0.311 0.024-0.621 0.05-0.93 0.076-9.072 0.768-23.194 1.688-59.153 2.687-33.777 0.94-59.409-1.246-59.664-1.268-0.116-0.014-0.534-0.064-1.195-0.145-0.026-2e-3 -0.053-6e-3 -0.079-9e-3 -4.769-0.584-21.392-2.681-29.973-4.507-2.672-0.57-6.349-1.061-10.083-1.061zm130.47 17.932c5.479 0.268 12.531 0.632 19.299 1.036 15.627 0.935 44.554-1.918 48.06-6.928 0.957-1.367 1.926-3.317 1.106-4.842-0.434-0.808-2.438-3.211-10.872-3.553-0.897-0.011-1.906-0.023-3.007-0.033-0.221 3e-3 -0.444 8e-3 -0.672 0.014-9.642 0.25-25.044 5.158-41.351 10.353-4.161 1.325-8.382 2.67-12.563 3.953zm-86.317-16.007c7.105 0.505 29.18 1.829 56.727 1.064 24.605-0.684 38.942-1.329 48.432-1.913l0.073-2.147c0.013-0.372 0.129-0.732 0.335-1.041 0.012-0.018 1.675-2.607 1.002-4.962-0.633-2.215-2.601-2.894-2.621-2.899-0.651-0.206-1.153-0.73-1.33-1.39-0.029-0.11-2.969-11.048-5.06-15.23-2.328-4.656-3.286-7.434-4.24-10.931-0.825-3.026-1.302-5.825-1.808-8.787l-0.282-1.644c-0.136-0.783-0.377-1.642-0.655-2.548-0.586 0.842-1.28 1.617-2.07 2.127-2.302 1.487-3.438 1.608-6.185 1.9l-0.229 0.024c-0.101 0.57 0.109 1.904 0.482 2.935 0.295 0.816 0.031 1.732-0.656 2.264-0.686 0.532-1.636 0.562-2.354 0.07-9e-3 -6e-3 -1.772-1.214-5.416-3.623-0.284-0.188-1.36-0.893-2.219-1.455l-0.325-0.213c-0.214-0.141-0.431-0.256-0.647-0.346-0.923 1.373-2.99 1.717-7.047 2.282-0.722 0.101-1.464 0.204-2.195 0.317-3.961 0.617-17.593 3.322-17.73 3.349-1 0.198-1.985-0.385-2.295-1.354-0.309-0.969 0.159-2.016 1.087-2.433 0.03-0.013 3.024-1.357 5.181-2.474 1.138-0.589 3.962-1.952 6.515-3.174-5.333-1.762-14.976-11.56-17.86-18.167-2.491-5.707 0-11.018 1.273-13.154-1.627 0.213-2.69 0.541-2.72 0.55-1.049 0.333-2.175-0.247-2.511-1.297-0.335-1.051 0.24-2.173 1.29-2.512 0.42-0.136 10.392-3.251 18.074 2.686 4.096 3.165 6.595 7.875 9.011 12.431 1.953 3.682 3.973 7.489 6.82 10.472 4.929 5.164 7.575 3.218 10.639 0.964 0.243-0.179 0.479-0.353 0.71-0.518 2.849-2.032 8.255-5 10.102-5.999 0.481-0.94 1.122-1.465 1.766-1.91 0.107-0.074 0.271-0.187 0.305-0.228 0 0 0.147-0.25 0.147-1.176 0-2.855-3.754-4.068-3.792-4.08-0.817-0.257-1.391-1.009-1.41-1.866-3e-3 -0.137-0.342-13.714-3.141-20.047-2.742-6.207-4.229-7.983-4.244-8-0.436-0.51-0.596-1.216-0.411-1.861s0.67-1.166 1.31-1.368c0.03-9e-3 2.988-0.946 5.902-2.019 2.069-0.762 4.475-3.316 5.187-7.304 1.056-5.915 5.249-5.899 9.696-5.905h0.471c2.112 0 4.87 0.31 8.064 0.668 4.16 0.468 8.878 0.996 13.019 0.909 1.28-0.027 1.975-0.186 2.325-0.308-0.424-0.73-1.9-2.383-5.676-4.648-4.625-2.775-12.281-4.812-17.87-6.298-2.666-0.709-4.771-1.269-5.979-1.763-2.726-1.115-3.979-3.27-4.987-5-0.497-0.854-0.967-1.661-1.466-2.045-2.04-1.568-13.267-0.954-18.062-0.691-8.549 0.468-9.658 2.522-11.867 6.616-0.436 0.808-0.93 1.724-1.513 2.678-3.457 5.657-11.239 16.955-11.568 17.433-0.34 0.494-0.884 0.809-1.481 0.858 0.029 0-3.201 0.62-8.36 7.273-4.475 5.77-9.495 30.521-11.908 42.416-0.691 3.41-1.238 6.103-1.603 7.597-1.66 6.788-4.437 18.147-10.954 26.168-2.225 2.739-3.51 5.554-4.288 8.283 0.431 0.566 1.295 1.172 2.941 0.72 1.931-0.531 3.499-1.446 5.016-2.331 1.556-0.907 3.025-1.764 4.658-2.025 2.058-0.329 4.051-0.658 4.813-0.785 1.559-0.833 8.665-4.618 10.827-5.502 0.183-0.075 0.44-0.188 0.768-0.332 11.304-4.954 22.594-7.339 33.564-7.069 17.031 0.408 23.427 9.484 25.835 12.9 0.197 0.279 0.362 0.516 0.503 0.699 2.015 2.606 2.842 5.739 2.876 5.871 0.22 0.849-0.139 1.743-0.886 2.204-0.748 0.461-1.707 0.38-2.367-0.197-0.041-0.036-4.668-3.968-11.51-4.343-3.058-0.167-5.568-0.2-7.586-0.227-3.146-0.042-5.418-0.071-7.398-0.566-0.651-0.163-1.342-0.365-2.068-0.578-2.441-0.715-5.21-1.525-8.018-1.166-1.797 0.23-3.21 0.689-4.577 1.133-1.554 0.504-3.16 1.025-5.071 1.089-3.04 0.1-21.934 0.011-24.08 2e-3 -0.606 0.101-2.762 0.458-4.994 0.815-0.895 0.143-1.998 0.786-3.274 1.531-1.575 0.919-3.536 2.062-5.97 2.731-2.006 0.551-3.627 0.309-4.882-0.29-0.21 1.515-0.326 2.969-0.434 4.333-0.083 1.045-0.162 2.016-0.271 2.895-0.447 3.568-3.236 7.994-5.325 10.882zm60.303-29.205c2.885 0 5.521 0.772 7.716 1.416 0.671 0.197 1.311 0.385 1.914 0.535 1.528 0.382 3.605 0.409 6.48 0.447 2.055 0.027 4.612 0.061 7.753 0.232 2.937 0.161 5.516 0.855 7.631 1.691-2.28-3.203-7.973-10.487-22.397-10.833-10.384-0.244-21.099 2.017-31.863 6.733-0.367 0.161-0.655 0.287-0.859 0.37-0.689 0.282-2.058 0.955-3.622 1.751 6.28 0.02 14.229 0.03 16.041-0.031 1.346-0.044 2.561-0.439 3.968-0.896 1.47-0.477 3.136-1.018 5.303-1.296 0.656-0.082 1.302-0.119 1.935-0.119zm9.697-23.764c0.209 0 0.43 0.015 0.661 0.043 1.088 0.135 2.143 0.533 3.133 1.181l0.325 0.213c0.866 0.567 1.951 1.277 2.235 1.466 0.652 0.431 1.245 0.824 1.778 1.179 0.088-0.625 0.275-1.23 0.607-1.764 0.597-0.96 1.574-1.558 2.752-1.684l0.406-0.043c2.544-0.271 2.936-0.312 4.437-1.282 0.948-0.613 2.116-2.978 2.624-4.419-0.245-1.165-0.418-2.39-0.458-3.685-2.286 1.283-5.221 2.991-6.982 4.247-0.215 0.153-0.435 0.315-0.662 0.482-2.986 2.197-8.544 6.287-15.903-1.424-3.229-3.382-5.38-7.438-7.46-11.359-2.32-4.374-4.511-8.504-7.923-11.141-2.345-1.812-5.048-2.523-7.475-2.715 0.091 0.524-0.025 1.083-0.369 1.542-0.099 0.136-3.648 5.098-1.45 10.134 2.598 5.952 11.583 14.739 15.484 15.98 3.258 1.037 4.26 1.236 4.486 1.272 0.809 0.019 1.55 0.53 1.835 1.325 0.347 0.968-0.097 2.042-1.026 2.482-0.032 0.016-1.202 0.57-2.792 1.329 1.147-0.208 2.131-0.378 2.834-0.487 0.752-0.117 1.516-0.224 2.259-0.327 1.251-0.174 3.002-0.417 3.978-0.667 0.07-0.323 0.209-0.627 0.417-0.9 0.495-0.651 1.25-0.978 2.249-0.978z"/>
    </svg>
  );

  const Button = () => (
    house === '' 
      ? <button className="button" onClick={handleClick}>Find out which Hogwarts House you belong!</button>
      : props.linkToSortedHouseBtn(house)
  );

  return (
    <div className='welcome'>
      <div className='sorting-hat'>
        <div className="sorting-hat__modal">
          <div className="sorting-hat__modal-box" />
          {renderSortingHat()}
          <h1>Welcome!</h1>
          <Button />
        </div>
      </div>
    </div>
  );
};

SortingHat.propTypes = {
  onJoin: PropTypes.func.isRequired,
  linkToSortedHouseBtn: PropTypes.func
};

export { SortingHat };
